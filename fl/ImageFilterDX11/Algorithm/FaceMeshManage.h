#pragma once
#include "BaseDefine/Define.h"
#include "BaseDefine/Vectors.h"
#include <vector>


struct FaceMeshData
{
	Vector2 *m_pVertices;
	Vector2 *m_pUV;
	int m_nVerts;
	unsigned short *m_pTriangle;
	int m_nTriangle;

};

enum FaceMeshType
{
	MESH_EYEBROW = 0,
	MESH_EYE,
	MESH_MOUTH,
	MESH_EYE_LID,

};
#define MAX_FACE_TYPE_NUM 5

class FaceMeshManage
{
public:
	FaceMeshManage();
	~FaceMeshManage();

	FaceMeshData *GetMesh(float *pFacePoint106, int nWidth, int nHeight, FaceMeshType eMeshType = MESH_EYEBROW);

	int GetMaxVerts();
	float m_FixLength;
	bool m_isCrop = false;
	bool m_IsMouthOpened;
	float m_EyeAlpha;
private:

	void TransformVertexMls(Vector2* pSrcPoint, Vector2* pDstPoint, Vector2* pSrcControl, Vector2* pDstControl, int nControlCount, int nPointCount);


	void EyeBrowInter(Vector2 *pFacePoint, Vector2 *pEyeBrowPoint);

	void MouthInter(Vector2 *pFacePoint, Vector2 *pMouthPoint);

	void EyeInter(Vector2 *pFacePoint, Vector2 *pEyePoint);

	void EyeInterLR(Vector2 *pEyePointSrc, Vector2 *pEyePointDst, Vector2 *pEyeUV, float direct = 1.0);

	void EyeInterLRNew(Vector2 *pEyePointSrc, Vector2 *pEyePointDst, Vector2 *pEyeUV, float direct);//

	Vector2 CalVerticalWithLength(Vector2 pos1, Vector2 pos2, float length);

	std::vector<float> m_EyeBrowUV = {
		 0.291521f,0.377580f,0.320803f,0.353396f,0.360309f,0.346359f,0.400915f,0.346668f,0.438714f,0.352978f,0.434735f,0.370438f,0.399246f,0.367759f,0.361490f,0.367862f,0.324524f,0.372015f,0.274564f,0.342286f,0.463014f,0.326676f,0.472834f,0.389233f,0.274640f,0.396120f,0.295500f,0.360120f,0.543981f,0.351910f,0.579852f,0.343968f,0.618766f,0.342035f,0.656765f,0.348257f,0.684745f,0.371529f,0.653617f,0.365700f,0.618504f,0.362560f,0.582698f,0.364385f,0.549016f,0.368801f,0.702479f,0.332645f,0.522192f,0.326293f,0.510331f,0.390381f,0.700872f,0.392677f,0.679710f,0.354638f,
	};
	std::vector<float> m_EyeBrowUVCrop = {
		 0.0841173f,0.3879f,0.142681f,0.26698f,0.221693f,0.231795f,0.302905f,0.23334f,0.378503f,0.26489f,0.370545f,0.35219f,0.299567f,0.338795f,0.224055f,0.33931f,0.150123f,0.360075f,0.0502033f,0.21143f,0.427103f,0.13338f,0.446743f,0.446165f,0.0503553f,0.4806f,0.0920753f,0.3006f,0.589037f,0.25955f,0.660779f,0.21984f,0.738607f,0.210175f,0.814605f,0.241285f,0.870565f,0.357645f,0.808309f,0.3285f,0.738083f,0.3128f,0.666471f,0.321925f,0.599107f,0.344005f,0.906033f,0.163225f,0.545459f,0.131465f,0.521737f,0.451905f,0.902819f,0.463385f,0.860495f,0.27319f,
	};
	std::vector<unsigned short>m_EyeBrowIndex = {
		10,4,2,10,9,2,9,2,13,2,4,5,2,5,7,2,7,0,13,2,0,9,13,0,9,0,12,0,7,12,7,5,12,12,5,11,4,11,5,4,10,11,24,16,14,24,23,16,16,23,27,14,16,22,16,20,22,16,18,20,16,27,18,23,27,18,23,18,26,20,18,26,22,20,26,26,25,22,14,22,25,24,14,25
	};

	std::vector<float>m_MouthUV = {
		 0.404898f,0.580214f,0.438523f,0.578391f,0.476807f,0.570491f,0.497873f,0.573378f,0.520762f,0.569580f,0.559046f,0.575504f,0.589836f,0.577935f,0.573226f,0.603154f,0.543044f,0.622144f,0.500778f,0.630132f,0.458576f,0.623359f,0.428395f,0.604673f,0.450879f,0.585379f,0.499088f,0.587354f,0.545070f,0.584620f,0.547022f,0.598698f,0.499088f,0.604369f,0.450069f,0.598748f,0.397075f,0.561711f,0.430703f,0.555468f,0.475530f,0.549388f,0.491586f,0.551861f,0.525472f,0.548464f,0.563386f,0.552655f,0.618823f,0.564815f,0.619930f,0.590310f,0.591623f,0.620208f,0.549134f,0.643424f,0.495093f,0.650723f,0.440768f,0.640864f,0.404894f,0.619400f,0.381039f,0.596136f,0.345766f,0.504622f,0.655684f,0.504350f,0.654959f,0.657134f,0.346129f,0.656862f,0.502147f,0.504275f,0.497759f,0.656717f,0.478427f,0.585379f,0.525421f,0.584923f,0.476807f,0.603154f,0.528055f,0.602394f,0.422926f,0.580366f,0.459387f,0.576112f,0.542842f,0.574897f,0.575859f,0.578543f,0.429526f,0.584201f,0.568210f,0.582928f,0.430092f,0.590994f,0.569342f,0.590145f,
	};
	std::vector<float>m_MouthUVCrop = {
		 0.306286f,0.399027f,0.377749f,0.378466f,0.453662f,0.35594f,0.50023f,0.366514f,0.545495f,0.35235f,0.616098f,0.372139f,0.685452f,0.390323f,0.643128f,0.508588f,0.585866f,0.60344f,0.503124f,0.642835f,0.416056f,0.611832f,0.352419f,0.520223f,0.383078f,0.40961f,0.500934f,0.420711f,0.61081f,0.407422f,0.616616f,0.473726f,0.500451f,0.53402f,0.376262f,0.480344f,0.297572f,0.292552f,0.368768f,0.272069f,0.460569f,0.248999f,0.490773f,0.260261f,0.553989f,0.245812f,0.628839f,0.212332f,0.731009f,0.324693f,0.733159f,0.450345f,0.681166f,0.589319f,0.600006f,0.707849f,0.492406f,0.748665f,0.381069f,0.697275f,0.305657f,0.582802f,0.259523f,0.461606f,0.200075f,0.0250431f,0.80674f,0.0111168f,0.791663f,0.764307f,0.184998f,0.778234f,0.503407f,0.0180799f,0.48833f,0.77127f,0.45207f,0.413143f,0.549141f,0.411456f,0.435791f,0.519274f,0.561431f,0.515373f,0.341483f,0.387362f,0.414686f,0.366382f,0.581934f,0.361091f,0.65031f,0.379957f,0.344682f,0.404319f,0.648131f,0.398872f,0.341274f,0.439685f,0.651034f,0.432025f,
	};
	std::vector<unsigned short>m_MouthIndex = {
		  42,18,19,18,42,0,0,31,18,31,0,11,13,40,38,40,13,16,47,5,45,5,47,14,42,19,1,19,43,1,43,19,20,43,20,2,39,44,14,44,39,4,2,3,38,3,2,21,14,49,15,49,14,47,3,4,39,4,3,21,21,2,20,3,39,13,23,44,22,44,23,5,4,21,22,23,45,5,6,25,7,25,6,24,17,38,40,38,17,12,6,7,49,7,26,8,26,7,25,38,3,13,7,8,15,8,27,9,27,8,26,46,12,48,12,46,1,8,9,41,9,28,10,28,9,27,48,12,17,9,10,40,10,29,11,29,10,28,11,0,48,10,11,17,11,30,31,30,11,29,12,1,43,38,43,2,43,38,12,41,9,16,39,41,13,41,39,15,13,41,16,15,39,14,5,14,44,15,8,41,7,15,49,16,9,40,10,17,40,17,11,48,4,22,44,42,1,46,0,42,46,0,46,48,47,45,6,47,6,49,6,24,45,23,24,45,
	};

	//用平滑曲线优化后的眼睛uv
	std::vector<float>m_EyeUV = {
		0.342069f,0.416715f,0.347722f,0.414022f,0.355852f,0.410296f,0.364361f,0.407415f,0.372702f,0.406041f,0.381422f,0.405512f,0.390061f,0.405723f,0.398686f,0.40658f,0.407229f,0.408177f,0.415034f,0.410687f,0.422315f,0.414961f,0.428858f,0.420147f,0.433363f,0.423869f,0.425619f,0.425012f,0.417875f,0.426154f,0.409897f,0.427331f,0.401986f,0.427666f,0.394076f,0.428002f,0.385926f,0.428347f,0.378158f,0.427315f,0.370391f,0.426283f,0.362388f,0.42522f,0.355683f,0.422413f,0.348977f,0.419606f,0.340999f,0.415451f,0.34564f,0.411467f,0.352142f,0.406566f,0.361516f,0.399818f,0.371495f,0.394849f,0.381825f,0.392762f,0.39276f,0.392454f,0.402789f,0.394232f,0.411967f,0.399566f,0.42024f,0.406986f,0.42594f,0.412388f,0.431813f,0.418135f,0.431289f,0.43876f,0.412641f,0.449464f,0.392446f,0.44661f,0.359152f,0.441905f,0.338957f,0.439051f,0.45337f,0.423592f,0.319822f,0.431747f,0.332142f,0.415937f,0.311623f,0.399086f,0.329725f,0.408062f,0.340018f,0.40729f,0.345768f,0.399961f,0.353234f,0.390464f,0.367602f,0.384006f,0.381263f,0.381541f,0.396203f,0.381526f,0.41196f,0.385356f,0.423452f,0.392362f,0.43198f,0.400018f,0.439735f,0.41358f,0.463026f,0.403826f,0.158743f,0.30884f,0.502393f,0.297742f,0.494899f,0.566298f,0.151249f,0.577395f,0.305141f,0.347167f,0.341011f,0.345559f,0.38738f,0.343481f,0.42325f,0.341874f,0.443138f,0.37285f,0.464079f,0.343944f,0.43084f,0.467298f,0.386902f,0.46868f,0.353607f,0.463974f,0.32766f,0.461204f,0.301713f,0.458433f,0.388156f,0.491118f,0.347499f,0.491651f,0.300291f,0.484247f,0.253083f,0.476844f,0.275909f,0.434727f,0.251527f,0.385208f,0.241853f,0.33329f,0.275259f,0.361098f,0.212191f,0.353333f,0.201003f,0.455473f,0.243097f,0.493574f,0.285192f,0.531676f,0.38941f,0.513556f,0.44687f,0.482129f,0.293325f,0.416863f,0.263393f,0.373153f,0.291067f,0.380171f,0.306629f,0.365848f,0.342499f,0.364241f,0.388273f,0.35469f,0.424441f,0.356819f,0.339225f,0.323141f,0.643358f,0.413368f,0.637501f,0.410865f,0.629088f,0.407411f,0.620357f,0.404801f,0.611914f,0.403667f,0.603152f,0.403378f,0.594498f,0.403829f,0.585874f,0.404941f,0.577356f,0.406793f,0.569599f,0.409523f,0.562404f,0.41397f,0.55597f,0.419294f,0.551542f,0.423108f,0.559431f,0.423864f,0.56732f,0.424619f,0.575448f,0.425398f,0.583403f,0.425445f,0.591357f,0.425492f,0.599553f,0.42554f,0.6073f,0.424359f,0.615046f,0.423177f,0.623028f,0.42196f,0.629737f,0.419124f,0.636446f,0.416289f,0.644346f,0.412067f,0.639418f,0.408239f,0.632628f,0.403551f,0.622854f,0.397108f,0.612572f,0.392449f,0.602104f,0.390665f,0.591127f,0.390666f,0.581148f,0.392718f,0.572171f,0.39829f,0.564192f,0.405914f,0.558707f,0.411456f,0.552959f,0.417327f,0.554338f,0.437932f,0.573216f,0.448255f,0.59359f,0.444788f,0.627178f,0.439072f,0.647552f,0.435604f,0.531769f,0.423173f,0.665966f,0.428094f,0.653241f,0.412319f,0.672676f,0.394832f,0.655117f,0.404267f,0.644568f,0.403721f,0.638519f,0.396614f,0.630596f,0.387496f,0.61589f,0.381499f,0.602103f,0.379436f,0.587167f,0.379837f,0.571602f,0.384067f,0.560394f,0.391357f,0.552171f,0.399221f,0.544913f,0.412897f,0.521398f,0.403473f,0.824036f,0.303009f,0.47922f,0.297602f,0.497466f,0.567229f,0.842282f,0.572636f,0.67746f,0.343013f,0.641152f,0.342371f,0.594218f,0.341542f,0.55791f,0.340901f,0.539654f,0.372187f,0.517731f,0.343649f,0.555576f,0.466402f,0.600216f,0.466689f,0.633805f,0.460973f,0.659422f,0.457686f,0.68504f,0.454399f,0.599959f,0.489146f,0.640482f,0.488802f,0.687136f,0.480537f,0.733789f,0.472272f,0.710083f,0.430515f,0.733031f,0.380493f,0.741533f,0.328589f,0.708808f,0.356849f,0.771676f,0.348224f,0.785589f,0.449999f,0.744378f,0.48879f,0.703167f,0.527581f,0.599703f,0.511603f,0.540755f,0.481678f,0.691976f,0.412003f,0.720919f,0.368671f,0.693621f,0.376204f,0.676872f,0.361722f,0.640565f,0.361081f,0.593865f,0.352768f,0.55744f,0.355869f,0.641857f,0.31992f,
	};
	std::vector<float>m_EyeUVCrop = {
		0.185213f,0.583573f,0.19652f,0.57011f,0.21278f,0.55148f,0.229798f,0.537077f,0.24648f,0.530205f,0.26392f,0.52756f,0.281198f,0.528613f,0.298446f,0.5329f,0.315534f,0.540885f,0.331144f,0.553435f,0.345705f,0.574804f,0.35879f,0.600737f,0.367802f,0.619347f,0.352314f,0.625059f,0.336826f,0.630772f,0.320869f,0.636657f,0.305048f,0.638332f,0.289227f,0.640008f,0.272927f,0.641734f,0.257392f,0.636575f,0.241857f,0.631416f,0.225852f,0.626101f,0.212441f,0.612066f,0.19903f,0.598032f,0.183073f,0.577253f,0.192356f,0.557334f,0.20536f,0.532829f,0.224108f,0.499091f,0.244066f,0.474243f,0.264726f,0.463812f,0.286594f,0.46227f,0.306654f,0.471158f,0.325009f,0.497828f,0.341555f,0.534929f,0.352956f,0.561942f,0.364702f,0.590673f,0.363653f,0.693801f,0.326358f,0.747321f,0.285968f,0.733051f,0.219379f,0.709524f,0.178989f,0.695254f,0.407816f,0.617958f,0.14072f,0.658734f,0.165358f,0.579683f,0.124321f,0.495431f,0.160525f,0.540309f,0.18111f,0.536449f,0.192611f,0.499807f,0.207544f,0.452319f,0.236279f,0.42003f,0.2636f,0.407707f,0.293481f,0.40763f,0.324995f,0.426779f,0.34798f,0.461812f,0.365036f,0.500088f,0.380545f,0.567901f,0.427126f,0.519132f,0.f,0.0441995f,0.505862f,0.f,0.490874f,1.f,0.f,1.f,0.111357f,0.235834f,0.183098f,0.227796f,0.275835f,0.217407f,0.347575f,0.209369f,0.387351f,0.36425f,0.429234f,0.219719f,0.362756f,0.836491f,0.274878f,0.843398f,0.208289f,0.819871f,0.156395f,0.806018f,0.104501f,0.792165f,0.277387f,0.955589f,0.196073f,0.958253f,0.101657f,0.921236f,0.00724034f,0.884218f,0.052893f,0.673637f,0.00412942f,0.426038f,0.f,0.16645f,0.0515925f,0.305491f,0.f,0.266665f,0.f,0.777365f,0.f,0.967872f,0.0714593f,1.f,0.279895f,1.f,0.394816f,0.910646f,0.0877245f,0.584315f,0.0278609f,0.365764f,0.0832089f,0.400857f,0.114334f,0.329241f,0.186074f,0.321204f,0.277621f,0.273452f,0.349957f,0.284096f,0.179526f,0.115707f,0.787791f,0.566839f,0.776077f,0.554327f,0.75925f,0.537056f,0.741789f,0.524004f,0.724902f,0.518337f,0.70738f,0.516889f,0.690071f,0.519145f,0.672823f,0.524704f,0.655788f,0.533966f,0.640273f,0.547613f,0.625884f,0.569849f,0.613015f,0.596468f,0.604159f,0.61554f,0.619937f,0.619318f,0.635716f,0.623096f,0.651972f,0.626988f,0.667881f,0.627223f,0.68379f,0.627459f,0.700181f,0.627702f,0.715674f,0.621793f,0.731168f,0.615885f,0.747131f,0.609798f,0.760549f,0.595622f,0.773967f,0.581445f,0.789768f,0.560334f,0.779911f,0.541194f,0.76633f,0.517752f,0.746784f,0.485539f,0.72622f,0.462247f,0.705283f,0.453327f,0.683329f,0.453329f,0.663371f,0.463591f,0.645417f,0.49145f,0.62946f,0.52957f,0.618489f,0.55728f,0.606993f,0.586637f,0.609751f,0.689662f,0.647508f,0.741276f,0.688255f,0.72394f,0.755432f,0.695358f,0.796179f,0.678021f,0.564613f,0.615864f,0.833007f,0.640469f,0.807557f,0.561597f,0.846428f,0.474161f,0.811309f,0.521335f,0.79021f,0.518603f,0.778114f,0.483068f,0.762267f,0.437482f,0.732855f,0.407497f,0.705282f,0.397182f,0.67541f,0.399183f,0.64428f,0.420337f,0.621863f,0.456785f,0.605417f,0.496104f,0.590902f,0.564485f,0.543872f,0.517366f,1.f,0.0150442f,0.459516f,0.f,0.496008f,1.f,1.f,1.f,0.855995f,0.215064f,0.783379f,0.211857f,0.68951f,0.207712f,0.616895f,0.204506f,0.580384f,0.360936f,0.536538f,0.218243f,0.612227f,0.832011f,0.701507f,0.833445f,0.768685f,0.804863f,0.81992f,0.788431f,0.871155f,0.771998f,0.700994f,0.945731f,0.78204f,0.944008f,0.875346f,0.902685f,0.968652f,0.861362f,0.921242f,0.652575f,0.967137f,0.402464f,0.984141f,0.142946f,0.918691f,0.284244f,1.f,0.24112f,1.f,0.749996f,0.989832f,0.943951f,0.90741f,1.f,0.700481f,1.f,0.582585f,0.908388f,0.885026f,0.560017f,0.942914f,0.343354f,0.888317f,0.381019f,0.85482f,0.308612f,0.782204f,0.305406f,0.688806f,0.263841f,0.615955f,0.279344f,0.784789f,0.0995988f,
	};
	std::vector<unsigned short>m_EyeIndex = {
		8,15,16,15,8,14,42,0,23,40,70,71,7,16,17,16,7,8,0,1,23,1,0,24,1,24,25,1,2,22,2,1,25,2,25,26,14,8,9,2,3,21,3,2,26,28,4,27,4,28,5,3,4,20,4,3,27,27,3,26,7,17,6,4,5,19,5,28,29,14,9,10,5,6,18,6,5,29,6,29,30,10,13,14,13,10,11,7,6,30,13,11,12,8,7,31,7,30,31,9,8,32,8,31,32,6,17,18,10,9,33,33,9,32,11,10,34,11,34,35,16,37,17,37,16,15,12,11,35,12,41,36,41,12,35,5,18,19,13,12,36,13,36,14,14,36,37,4,19,20,15,14,37,3,20,21,17,38,18,38,17,37,2,21,22,19,18,38,20,19,39,39,19,38,1,22,23,21,20,39,22,21,40,21,39,40,23,22,40,23,40,42,26,25,46,47,27,26,27,47,48,26,46,47,28,27,48,49,28,48,28,49,29,30,29,50,50,29,49,31,30,51,51,30,50,10,33,34,32,31,52,32,53,33,53,32,52,52,31,51,34,33,54,35,34,55,34,54,55,67,68,37,41,67,36,37,36,67,37,68,38,69,38,68,38,69,39,41,35,55,42,40,71,43,42,86,71,86,42,86,71,76,44,43,86,89,44,88,90,89,62,62,89,61,90,91,49,91,90,62,48,47,90,90,49,48,50,49,91,33,53,54,41,55,56,76,87,86,65,92,64,91,62,63,63,92,91,92,63,64,88,86,87,86,88,44,88,87,79,79,61,89,88,79,89,91,50,51,91,92,51,92,51,52,92,52,53,40,70,39,70,69,39,92,53,54,92,54,65,89,47,90,54,55,56,65,54,56,44,46,47,89,44,47,25,46,24,44,46,43,43,24,46,43,24,0,43,0,42,102,109,110,109,102,108,136,94,117,134,164,165,101,110,111,110,101,102,94,95,117,95,94,118,95,118,119,95,96,116,96,95,119,96,119,120,108,102,103,96,97,115,97,96,120,122,98,121,98,122,99,97,98,114,98,97,121,121,97,120,101,111,100,98,99,113,99,122,123,108,103,104,99,100,112,100,99,123,100,123,124,104,107,108,107,104,105,101,100,124,107,105,106,102,101,125,101,124,125,103,102,126,102,125,126,100,111,112,104,103,127,127,103,126,105,104,128,105,128,129,110,131,111,131,110,109,106,105,129,106,135,130,135,106,129,99,112,113,107,106,130,107,130,108,108,130,131,98,113,114,109,108,131,97,114,115,111,132,112,132,111,131,96,115,116,113,112,132,114,113,133,133,113,132,95,116,117,115,114,133,116,115,134,115,133,134,117,116,134,117,134,136,120,119,140,141,121,120,121,141,142,120,140,141,122,121,142,143,122,142,122,143,123,124,123,144,144,123,143,125,124,145,145,124,144,104,127,128,126,125,146,126,147,127,147,126,146,146,125,145,128,127,148,129,128,149,128,148,149,161,162,131,135,161,130,131,130,161,131,162,132,163,132,162,132,163,133,135,129,149,136,134,165,137,136,180,165,180,136,180,165,170,138,137,180,183,138,182,184,183,156,156,183,155,184,185,143,185,184,156,142,141,184,184,143,142,144,143,185,127,147,148,135,149,150,170,181,180,159,186,158,185,156,157,157,186,185,186,157,158,182,180,181,180,182,138,182,181,173,173,155,183,182,173,183,185,144,145,185,186,145,186,145,146,186,146,147,134,164,133,164,163,133,186,147,148,186,148,159,183,141,184,148,149,150,159,148,150,138,140,141,183,138,141,119,140,118,138,140,137,137,118,140,137,118,94,137,94,136,
	};
	FaceMeshData *m_MeshData;
	std::vector<Vector2>m_Vertices;
	int m_nWidth;
	int m_nHeight;
};

